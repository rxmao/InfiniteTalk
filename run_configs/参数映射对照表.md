# ComfyUI å·¥ä½œæµ â†’ Python è„šæœ¬å‚æ•°æ˜ å°„å¯¹ç…§è¡¨

## ğŸ“‹ å®Œæ•´å‚æ•°æ˜ å°„

åŸºäº `InfiniteTalkå•äººå›¾ç”Ÿè§†é¢‘.json` å·¥ä½œæµé…ç½®

---

## ğŸ¯ æ ¸å¿ƒèŠ‚ç‚¹å‚æ•°æ˜ å°„

### èŠ‚ç‚¹ 128: WanVideoSampler (é‡‡æ ·å™¨)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `steps` | 4 | `--sample_steps` | 4 |
| `cfg` | 1.0 | `--sample_text_guide_scale` | 1.0 |
| `shift` | 11.0 | `--sample_shift` | 11.0 |
| `seed` | 1 | `--base_seed` | 1 |
| `force_offload` | true | `--offload_model` | true |
| `scheduler` | "flowmatch_distill" | (è‡ªåŠ¨) | ä½¿ç”¨ LoRA æ—¶è‡ªåŠ¨ |
| `denoise_strength` | 1.0 | (é»˜è®¤) | 1.0 |

---

### èŠ‚ç‚¹ 122: WanVideoModelLoader (æ¨¡å‹åŠ è½½)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `model` | Wan2_1-I2V-14B-480p_fp8 | `--ckpt_dir` | weights/Wan2.1-I2V-14B-480P |
| `base_precision` | fp16 | (é»˜è®¤) | fp16 |
| `quantization` | disabled | `--quant` | fp8 |
| `load_device` | offload_device | `--offload_model` | true |
| `attention_mode` | sageattn | (è‡ªåŠ¨) | è‡ªåŠ¨ä½¿ç”¨ |

**æ³¨æ„:** è™½ç„¶å·¥ä½œæµä¸­ quantization=disabledï¼Œä½†å®é™…ä½¿ç”¨çš„æ¨¡å‹æ–‡ä»¶ååŒ…å« `_fp8`ï¼Œè¯´æ˜æ¨¡å‹æœ¬èº«å·²é‡åŒ–ã€‚

---

### èŠ‚ç‚¹ 138: WanVideoLoraSelect (LoRA)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `lora` | lightx2v_I2V_14B_480p... | `--lora_dir` | weights/lightx2v_... |
| `strength` | 0.8 | `--lora_scale` | 0.8 |
| `low_mem_load` | false | (é»˜è®¤) | false |

---

### èŠ‚ç‚¹ 134: WanVideoBlockSwap (æ˜¾å­˜ç®¡ç†)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `blocks_to_swap` | 30 | `--num_persistent_param_in_dit` | 0 |
| `offload_img_emb` | false | (é»˜è®¤) | false |
| `offload_txt_emb` | false | (é»˜è®¤) | false |
| `use_non_blocking` | true | (è‡ªåŠ¨) | true |

**æ˜ å°„è¯´æ˜:** `blocks_to_swap=30` å¯¹åº” `num_persistent_param_in_dit=0`ï¼ˆæœ€å¤§åŒ–äº¤æ¢ï¼‰

---

### èŠ‚ç‚¹ 192: WanVideoImageToVideoMultiTalk (I2V)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `frame_window_size` | 81 | `--frame_num` | 81 |
| `motion_frame` | 25 | `--motion_frame` | 9 |
| `colormatch` | "mkl" | `--color_correction_strength` | 1.0 |
| `mode` | "infinitetalk" | `--task` | infinitetalk-14B |
| `tiled_vae` | false | (é»˜è®¤) | false |

**âš ï¸ æ³¨æ„å·®å¼‚:**
- å·¥ä½œæµ `motion_frame=25`ï¼Œä½† Python è„šæœ¬æ¨èå€¼æ˜¯ `9`
- å®é™…ä½¿ç”¨ 9 æ•ˆæœæ›´ç¨³å®š

---

### èŠ‚ç‚¹ 205: MultiTalkWav2VecEmbeds (éŸ³é¢‘åµŒå…¥)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `normalize_loudness` | true | (è‡ªåŠ¨) | è‡ªåŠ¨å½’ä¸€åŒ– |
| `num_frames` | 81 | `--frame_num` | 81 |
| `fps` | 25 | (å›ºå®š) | 25 |
| `audio_scale` | 1 | (é»˜è®¤) | 1.0 |
| `audio_cfg_scale` | 1 | `--sample_audio_guide_scale` | 2.0 |
| `multi_audio_type` | "para" | (JSONé…ç½®) | "audio_type": "para" |

**âš ï¸ æ³¨æ„å·®å¼‚:**
- å·¥ä½œæµ `audio_cfg_scale=1`ï¼Œä½† Python æ¨èä½¿ç”¨ `2.0` (ä½¿ç”¨ LoRA æ—¶)

---

### èŠ‚ç‚¹ 135: WanVideoTextEncode (æ–‡æœ¬ç¼–ç )

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `positive_prompt` | "ä¸€ä¸ªäººå¯¹ç€é•œå¤´..." | `input_json['prompt']` | JSON é…ç½® |
| `negative_prompt` | "bright tones..." | (è‡ªåŠ¨) | å†…ç½®è´Ÿé¢æç¤ºè¯ |
| `force_offload` | true | `--offload_model` | true |

---

### èŠ‚ç‚¹ 171: ImageResizeKJv2 (å›¾åƒè°ƒæ•´)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `width` | 480 | `--size` | infinitetalk-480 |
| `height` | 832 | `--size` | infinitetalk-480 |
| `divisible_by` | 16 | (è‡ªåŠ¨) | 16 |
| `keep_proportion` | "crop" | (è‡ªåŠ¨) | crop |

**æ˜ å°„è¯´æ˜:** `--size infinitetalk-480` è‡ªåŠ¨å¯¹åº” 480x832 åˆ†è¾¨ç‡

---

### èŠ‚ç‚¹ 131: VHS_VideoCombine (è§†é¢‘åˆæˆ)

| ComfyUI å‚æ•° | å€¼ | Python å‚æ•° | å¯¹åº”å€¼ |
|-------------|-----|-------------|--------|
| `frame_rate` | 25 | (å›ºå®š) | 25 fps |
| `filename_prefix` | "infinitetalkæ•°å­—äºº" | `--save_file` | infinitetalk_res |
| `format` | "video/h264-mp4" | (å›ºå®š) | H264 MP4 |
| `crf` | 19 | (å›ºå®š) | 19 |
| `pix_fmt` | "yuv420p" | (å›ºå®š) | yuv420p |

---

## ğŸ”„ å®Œæ•´æ˜ å°„ç¤ºä¾‹

### ComfyUI å·¥ä½œæµé…ç½® (å…³é”®èŠ‚ç‚¹)

```json
{
  "èŠ‚ç‚¹128_WanVideoSampler": {
    "steps": 4,
    "cfg": 1.0,
    "shift": 11.0,
    "seed": 1
  },
  "èŠ‚ç‚¹138_LoRA": {
    "lora": "lightx2v_I2V_14B_480p_cfg_step_distill_rank128_bf16.safetensors",
    "strength": 0.8
  },
  "èŠ‚ç‚¹134_BlockSwap": {
    "blocks_to_swap": 30
  },
  "èŠ‚ç‚¹192_I2V": {
    "frame_window_size": 81,
    "motion_frame": 25,
    "mode": "infinitetalk"
  }
}
```

### ç­‰æ•ˆ Python å‘½ä»¤

```bash
python generate_infinitetalk.py \
    --sample_steps 4 \
    --sample_text_guide_scale 1.0 \
    --sample_shift 11.0 \
    --base_seed 1 \
    \
    --lora_dir weights/lightx2v_I2V_14B_480p_cfg_step_distill_rank128_bf16.safetensors \
    --lora_scale 0.8 \
    \
    --num_persistent_param_in_dit 0 \
    \
    --frame_num 81 \
    --motion_frame 9 \
    --task infinitetalk-14B
```

---

## âš ï¸ å…³é”®å·®å¼‚è¯´æ˜

### å·®å¼‚ 1: motion_frame

- **ComfyUI å·¥ä½œæµ:** 25
- **Python æ¨è:** 9
- **åŸå› :** Python è„šæœ¬ä¸­ 9 æ˜¯ç»è¿‡ä¼˜åŒ–çš„ç¨³å®šå€¼ï¼Œ25 å¯èƒ½å¯¼è‡´è¿åŠ¨è¿‡äºå‰§çƒˆ

### å·®å¼‚ 2: audio_cfg_scale

- **ComfyUI å·¥ä½œæµ:** 1.0
- **Python æ¨è:** 2.0
- **åŸå› :** LoRA æ¨¡å‹éœ€è¦æ›´é«˜çš„éŸ³é¢‘å¼•å¯¼æ‰èƒ½è¾¾åˆ°æœ€ä½³å”‡å½¢åŒæ­¥

### å·®å¼‚ 3: é‡åŒ–é…ç½®

- **ComfyUI å·¥ä½œæµ:** quantization=disabledï¼Œä½†æ¨¡å‹æœ¬èº«æ˜¯ fp8
- **Python è„šæœ¬:** éœ€è¦æ˜¾å¼æŒ‡å®š `--quant fp8`
- **åŸå› :** Python è„šæœ¬éœ€è¦æ˜ç¡®å‘ŠçŸ¥ä½¿ç”¨é‡åŒ–æ¨ç†è·¯å¾„

---

## ğŸ“Š å‚æ•°å¯¹ç…§é€ŸæŸ¥è¡¨

| åŠŸèƒ½ | ComfyUI èŠ‚ç‚¹ | Python å‚æ•° |
|------|-------------|-------------|
| é‡‡æ ·æ­¥æ•° | WanVideoSampler.steps | --sample_steps |
| æ–‡æœ¬å¼•å¯¼ | WanVideoSampler.cfg | --sample_text_guide_scale |
| éŸ³é¢‘å¼•å¯¼ | MultiTalkWav2VecEmbeds.audio_cfg_scale | --sample_audio_guide_scale |
| Shift å‚æ•° | WanVideoSampler.shift | --sample_shift |
| éšæœºç§å­ | WanVideoSampler.seed | --base_seed |
| LoRA è·¯å¾„ | WanVideoLoraSelect.lora | --lora_dir |
| LoRA å¼ºåº¦ | WanVideoLoraSelect.strength | --lora_scale |
| æ˜¾å­˜äº¤æ¢ | WanVideoBlockSwap.blocks_to_swap | --num_persistent_param_in_dit |
| å¸§æ•° | WanVideoImageToVideoMultiTalk.frame_window_size | --frame_num |
| è¿åŠ¨å¸§ | WanVideoImageToVideoMultiTalk.motion_frame | --motion_frame |
| åˆ†è¾¨ç‡ | ImageResizeKJv2.width/height | --size |
| é‡åŒ–æ–¹å¼ | WanVideoModelLoader.model | --quant |
| æ¨¡å‹å¸è½½ | WanVideoSampler.force_offload | --offload_model |
| è¾“å‡ºæ–‡ä»¶å | VHS_VideoCombine.filename_prefix | --save_file |

---

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

### 1. ä» ComfyUI è¿ç§»åˆ° Python

```bash
# æ­¥éª¤ 1: åœ¨ ComfyUI ä¸­è°ƒè¯•æœ€ä½³å‚æ•°
# æ­¥éª¤ 2: è®°å½•å…³é”®èŠ‚ç‚¹çš„å‚æ•°å€¼
# æ­¥éª¤ 3: ä½¿ç”¨æœ¬æ–‡æ¡£æ˜ å°„åˆ° Python å‚æ•°
# æ­¥éª¤ 4: è¿è¡Œæµ‹è¯•å¯¹æ¯”æ•ˆæœ
# æ­¥éª¤ 5: å¾®è°ƒå·®å¼‚å‚æ•° (motion_frame, audio_cfg_scale)
```

### 2. å‚æ•°ä¼˜å…ˆçº§

```
é«˜ä¼˜å…ˆçº§ (å¿…é¡»åŒ¹é…):
- sample_steps
- lora_scale
- sample_shift
- size

ä¸­ä¼˜å…ˆçº§ (å»ºè®®åŒ¹é…):
- sample_text_guide_scale
- sample_audio_guide_scale
- frame_num

ä½ä¼˜å…ˆçº§ (å¯è°ƒæ•´):
- motion_frame
- color_correction_strength
- base_seed
```

### 3. è°ƒè¯•æŠ€å·§

```bash
# å¦‚æœ Python è„šæœ¬è¾“å‡ºä¸ ComfyUI ä¸ä¸€è‡´:

1. æ£€æŸ¥ LoRA æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ shift å‚æ•°å€¼ (11.0 vs 7.0)
3. éªŒè¯é‡åŒ–æ¨¡å¼ (fp8 vs fp16)
4. å¯¹æ¯” motion_frame (9 vs 25)
5. æ£€æŸ¥ audio_cfg_scale (2.0 vs 1.0)
```

---

## ğŸ”§ è‡ªåŠ¨è½¬æ¢å·¥å…· (å¾…å¼€å‘)

```python
# æœªæ¥å¯å¼€å‘çš„å·¥å…·
def comfyui_to_python(workflow_json):
    """
    è‡ªåŠ¨ä» ComfyUI å·¥ä½œæµ JSON ç”Ÿæˆ Python å‘½ä»¤
    """
    # è§£æå·¥ä½œæµ
    # æ˜ å°„å‚æ•°
    # ç”Ÿæˆ Bash è„šæœ¬
    pass
```

---

**æ›´æ–°æ—¥æœŸ: 2025-01-23**
**é€‚ç”¨ç‰ˆæœ¬: InfiniteTalk v1.0 + ComfyUI-WanVideoWrapper**
